## 网络基础概念归纳
>参考 https://mp.weixin.qq.com/s/W94ZUxGQHGDqBwIXHHD6jA

### 因特网协议栈
![internet protocol stack](https://github.com/bearnew/picture/blob/master/mardown/2019-05-05%20network/protocol.jpg?raw=true)
##### 1. 应用层
* 通过应用进程间的交互来完成特定网络应用
* DNS(domain Name System)
  * 将域名和IP地址相互映射的一个分布式数据库,让人们不用记IP，更方便的访问数据库
* HTTP(HyperText Transfer Protocol)
  * 互联网上引用最广泛的网络协议
  * 所有WWW(万维网)都必须遵循这个标准
##### 2. 传输层
* 为两个主机应用的进程提供通用的数据传输服务
* TCP(Transmission Control Protocol 传输控制协议)
  * 面向连接
  * 每一条TCP连接只能有2个端点，每一条TCP连接只能1对1
  * 提供可靠（无差错、不丢失、不重复、按序到达）的交互服务
  * 全双工通信
  * 面向字节流,TCP中的流指流入进程或进程流出的字节序列
* UDP(User Datagram Protocol 用户数据协议)
  * UDP是无连接的
  * 不保证可靠交互
  * 面向报文
  * UDP没有拥塞控制，网络出现拥塞不会使源主机的发送速率降低(对直播、实时视频会议等很有用)
  * UDP支持一对一，一对多，多对一，多对多的交互通信
  * UDP首部开销小，只有8个字节，比TCP的20个字节的首部要短
* 通信方式
  * 单工数据传输只支持数据在一个方向上传输
  * 半双工数据传输是可以切换方向的单工通信
  * 全双工数据通信是两个半双工数据传输的结合，允许数据在两个方向上传输，发送设备和接受设备都有独立的接收和发送能力
##### 3.网络层
* 发送数据时，网络层把传输层产生的报文段或用户数据报封装成分组和包进行传送
* IP(Internet Protocol Address)
##### 4.数据链路层
* 数据链路层将网络层接收下来的IP数据报组装成帧，在两个相邻节点间的链路上传送帧
##### 5.物理层
* 实现相邻计算机节点之间比特流的透明传送

### HTTP和HTTPS
##### 1.HTTP（HyperText Transfer Protocol: 超文本传输协议）
用于分布式、协作式、超媒体信息系统的应用层协议, 用于在web浏览器和网站服务器之间传递信息
##### 2.HTTPS（HyperText Transfer Protocol Secure: 超文本传输安全协议）
HTTPS由http进行通信，但利用SSL/TLS来加密数据包
##### 3.HTTPS通信过程
1. TCP三次同步握手
2. 客户端验证服务器数字证书
3. DH算法协商对称加密算法的密钥、hash算法的密钥
4. SSL安全加密隧道协商完成
5. 网页以加密的方式传输，用协商的对称加密算法和密钥加密，保证数据机密性；用协商的hash算法进行数据完整性的保护，保证数据不被篡改
##### 4.区别
| 区别 | HTTP | HTTPS |
|:----:|:-----:|:------:|
| 协议 | 运行在TCP上，明文传输，数据都是未加密的，安全性差 | 运行在SSL上，SSL运行在TCP上，是添加了加密和认证机制的HTTP |
| 端口 | 80 | 443 |
| 资源消耗 | HTTP使用TCP三次握手建立连接，客户端和服务端交互3个包,响应速度快 | HTTPS除了TCP的3个包，还需要加上SSL握手的9个包，共12个包,响应速度慢 |
| 开销 | 无需证书 | HTTPS协议需要的证书，可以到 CA（Certificate Authority，数字证书认证机构）申请证书， 也可以自己制作。<br/>申请的证书无需客户端验证，自己制作的证书需要客户端验证通过才能继续访问 |
| 加密机制 | 无需加密 | 非对称加密 + 对称加密 |
| 安全性 | 弱 | 强 |
##### 5.对称加密
* 加解密使用的同一串密钥
* 对称加密只有一个密钥作为私钥
* 常见的对称加密算法: DES, AES等
##### 6.非对称加密
* 加解密使用不同的密钥，一个公钥，一个私钥
* 公钥加密的只有私钥才能解密
* 私钥加密的只有公钥才能解密
* 常见的非对称加密算法: RSA
##### 7.数字证书
* 数字证书的包含内容
  * 签发者
  * 证书用途
  * 公钥
  * 加密算法
  * Hash算法
  * 证书到期时间
##### 8.数字签名
* 服务器将server的信息、证书的信息、公钥等hash成一个128位的hash值
* 再用私钥进行加密, 生成数字签名
##### 9.HTTPS的通信过程
* 通信原理
  * 确认加密算法的过程使用的是非对称性加密
  * 数据传输过程使用的是对称性加密(非对称加密能保证数据的安全性，但速度较慢)
* 通信过程
  1. 服务器将携带的公钥向CA申请证书
  2. 数字证书机构颁发证书，返回服务器
  3. 服务器生成一个数字签名
  4. 服务器将证书和数字签名发给客户端
  5. 客户端验证证书，证书机构通过验证，或用户接受非权威机构颁发的证书，获取公钥
  6. 客户端用公钥解密数字签名，与自己计算的Hash进行对比,如果2者一致，则证明安全，继续通信
  7. 客户端使用公钥加密报文发送给服务器，其中携带随机串，其中的随机串用户传输数据时进行对称加密
  8. 服务器使用私钥解密，获取报文信息及随机串
  9. 解密后服务器发送握手信息给客户端,之后client和server通信，就使用随机值进行加密和解密了
  10. 客户端接收到握手信息，握手结束，双发确认加密算法（使用随机串确定的对称性加密），开始传输
  11. 服务器使用随机串加密信息传给客户端
  12. 客户端使用随机串进行解密信息
##### 10.HTTP2
* http1中浏览器限制了同一域名下的请求数量（chrome下是6个）
* http2引入了多路复用技术，一个TCP可以传输所有的请求数据，绕过了浏览器同一域名请求数量限制的问题

### IP/MAC
* 五类IP地址
  * A类 政府机关 1.0.0.1—126.155.255.254
  * B类 中等规模公司 128.0.0.1—191.255.255.254
  * C类 私有地址 192.0.0.1—223.255.255.254
  * D类 广播地址 224.0.0.1—239.255.255.254
  * E类 用于实验 240.0.0.1—255.255.255.254
* IP地址，节点被分配到的地址
* MAC地址，网卡所属的固定地址
* 使用ARP协议凭借MAC地址进行通信
  * IP间的通信依赖MAC地址
  * ARP是一种解释地址协议，可以根据IP地址反查出MAC地址

### TCP保证传输的可靠性
1. 数据包校验: 若校验包出错，则丢弃报文并不给出响应，TCP发送数据端超时后会重发数据
2. 对失序包重排序
3. 丢弃重复数据
4. 应答机制：当TCP收到TCP连接另一端的数据，会发送一个确认
5. 超时重发
6. 流量控制

### TCP3次握手，4次挥手

### DNS
* DNS解析过程
  * 浏览器搜索自己的DNS缓存，没有命中，则进入下一步
  * 搜索操作系统的DNS缓存，没有命中，则进入下一步
  * 搜索操作系统的Hosts文件，没有命中，则进入下一步
  * 发送域名到LDNS（本地区域名服务器），查询DNS缓存，没有命中，则进入下一步
  * LDNS向Root Name Server 根域名服务器（com、net、im等顶级域名服务器）发起请求, 根域名服务器返回顶级域名服务器地址
  * LDNS向顶级域名服务器发起请求，得到域名服务器地址
  * LDNS向域名服务器发起请求，得到IP地址
  * LDNS将IP返回给操作系统，同时将IP缓存起来，操作系统将IP地址返回给浏览器，同时将IP缓存起来
* DNS优化
  * 减少DNS请求次数
  * 进行DNS预获取, DNS Prefetch

### CDN（content delivery network）
* 构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络阻塞，提高用户访问响应速度和命中率
* CDN的核心
  * 缓存
  * 回源（十分钟回源更新一次）
* cookie紧跟域名请求，为了减少不必要的开销，将主站和静态资源置于不同的域名下
